{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport * as React from 'react';\nimport { useState, useRef, useEffect } from 'react';\nimport { STATUS_APPEAR, STATUS_NONE, STATUS_LEAVE, STATUS_ENTER, STEP_PREPARE, STEP_START, STEP_ACTIVE } from '../interface';\nimport useIsomorphicLayoutEffect from './useIsomorphicLayoutEffect';\nimport useStepQueue, { DoStep, SkipStep, isActive } from './useStepQueue';\nimport useDomMotionEvents from './useDomMotionEvents'; // import useFrameStep, { StepMap, StepCell } from './useFrameStep';\n\nexport default function useStatus(supportMotion, visible, getElement, _ref) {\n  var _ref$motionEnter = _ref.motionEnter,\n      motionEnter = _ref$motionEnter === void 0 ? true : _ref$motionEnter,\n      _ref$motionAppear = _ref.motionAppear,\n      motionAppear = _ref$motionAppear === void 0 ? true : _ref$motionAppear,\n      _ref$motionLeave = _ref.motionLeave,\n      motionLeave = _ref$motionLeave === void 0 ? true : _ref$motionLeave,\n      motionDeadline = _ref.motionDeadline,\n      motionLeaveImmediately = _ref.motionLeaveImmediately,\n      onAppearPrepare = _ref.onAppearPrepare,\n      onEnterPrepare = _ref.onEnterPrepare,\n      onLeavePrepare = _ref.onLeavePrepare,\n      onAppearStart = _ref.onAppearStart,\n      onEnterStart = _ref.onEnterStart,\n      onLeaveStart = _ref.onLeaveStart,\n      onAppearActive = _ref.onAppearActive,\n      onEnterActive = _ref.onEnterActive,\n      onLeaveActive = _ref.onLeaveActive,\n      onAppearEnd = _ref.onAppearEnd,\n      onEnterEnd = _ref.onEnterEnd,\n      onLeaveEnd = _ref.onLeaveEnd;\n\n  var _useState = useState(STATUS_NONE),\n      _useState2 = _slicedToArray(_useState, 2),\n      status = _useState2[0],\n      setStatus = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      style = _useState4[0],\n      setStyle = _useState4[1];\n\n  var mountedRef = useRef(false);\n  var deadlineRef = useRef(null); // =========================== Dom Node ===========================\n\n  var cacheElementRef = useRef(null);\n\n  function getDomElement() {\n    var element = getElement();\n    return element || cacheElementRef.current;\n  } // ========================== Motion End ==========================\n\n\n  var activeRef = useRef(false);\n\n  function onInternalMotionEnd(event) {\n    var element = getDomElement();\n\n    if (event && !event.deadline && event.target !== element) {\n      // event exists\n      // not initiated by deadline\n      // transitionEnd not fired by inner elements\n      return;\n    }\n\n    var canEnd;\n\n    if (status === STATUS_APPEAR && activeRef.current) {\n      canEnd = onAppearEnd === null || onAppearEnd === void 0 ? void 0 : onAppearEnd(element, event);\n    } else if (status === STATUS_ENTER && activeRef.current) {\n      canEnd = onEnterEnd === null || onEnterEnd === void 0 ? void 0 : onEnterEnd(element, event);\n    } else if (status === STATUS_LEAVE && activeRef.current) {\n      canEnd = onLeaveEnd === null || onLeaveEnd === void 0 ? void 0 : onLeaveEnd(element, event);\n    }\n\n    if (canEnd !== false) {\n      setStatus(STATUS_NONE);\n      setStyle(null);\n    }\n  }\n\n  var _useDomMotionEvents = useDomMotionEvents(onInternalMotionEnd),\n      _useDomMotionEvents2 = _slicedToArray(_useDomMotionEvents, 1),\n      patchMotionEvents = _useDomMotionEvents2[0]; // ============================= Step =============================\n\n\n  var eventHandlers = React.useMemo(function () {\n    var _ref2, _ref3, _ref4;\n\n    switch (status) {\n      case 'appear':\n        return _ref2 = {}, _defineProperty(_ref2, STEP_PREPARE, onAppearPrepare), _defineProperty(_ref2, STEP_START, onAppearStart), _defineProperty(_ref2, STEP_ACTIVE, onAppearActive), _ref2;\n\n      case 'enter':\n        return _ref3 = {}, _defineProperty(_ref3, STEP_PREPARE, onEnterPrepare), _defineProperty(_ref3, STEP_START, onEnterStart), _defineProperty(_ref3, STEP_ACTIVE, onEnterActive), _ref3;\n\n      case 'leave':\n        return _ref4 = {}, _defineProperty(_ref4, STEP_PREPARE, onLeavePrepare), _defineProperty(_ref4, STEP_START, onLeaveStart), _defineProperty(_ref4, STEP_ACTIVE, onLeaveActive), _ref4;\n\n      default:\n        return {};\n    }\n  }, [status]);\n\n  var _useStepQueue = useStepQueue(function (newStep) {\n    // Only prepare step can be skip\n    if (newStep === STEP_PREPARE) {\n      var onPrepare = eventHandlers[STEP_PREPARE];\n\n      if (!onPrepare) {\n        return SkipStep;\n      }\n\n      return onPrepare(getDomElement());\n    } // Rest step is sync update\n\n\n    if (step in eventHandlers) {\n      var _eventHandlers$step;\n\n      setStyle(((_eventHandlers$step = eventHandlers[step]) === null || _eventHandlers$step === void 0 ? void 0 : _eventHandlers$step.call(eventHandlers, getDomElement(), null)) || null);\n    }\n\n    if (step === STEP_ACTIVE) {\n      // Patch events when motion needed\n      patchMotionEvents(getDomElement());\n\n      if (motionDeadline > 0) {\n        clearTimeout(deadlineRef.current);\n        deadlineRef.current = setTimeout(function () {\n          onInternalMotionEnd({\n            deadline: true\n          });\n        }, motionDeadline);\n      }\n    }\n\n    return DoStep;\n  }),\n      _useStepQueue2 = _slicedToArray(_useStepQueue, 2),\n      startStep = _useStepQueue2[0],\n      step = _useStepQueue2[1];\n\n  var active = isActive(step);\n  activeRef.current = active; // ============================ Status ============================\n  // Update with new status\n\n  useIsomorphicLayoutEffect(function () {\n    if (!supportMotion) {\n      return;\n    }\n\n    var isMounted = mountedRef.current;\n    mountedRef.current = true;\n    var nextStatus; // Appear\n\n    if (!isMounted && visible && motionAppear) {\n      nextStatus = STATUS_APPEAR;\n    } // Enter\n\n\n    if (isMounted && visible && motionEnter) {\n      nextStatus = STATUS_ENTER;\n    } // Leave\n\n\n    if (isMounted && !visible && motionLeave || !isMounted && motionLeaveImmediately && !visible && motionLeave) {\n      nextStatus = STATUS_LEAVE;\n    } // Update to next status\n\n\n    if (nextStatus) {\n      setStatus(nextStatus);\n      startStep();\n    }\n  }, [visible]); // ============================ Effect ============================\n  // Reset when motion changed\n\n  useEffect(function () {\n    if ( // Cancel appear\n    status === STATUS_APPEAR && !motionAppear || // Cancel enter\n    status === STATUS_ENTER && !motionEnter || // Cancel leave\n    status === STATUS_LEAVE && !motionLeave) {\n      setStatus(STATUS_NONE);\n    }\n  }, [motionAppear, motionEnter, motionLeave]);\n  useEffect(function () {\n    return function () {\n      clearTimeout(deadlineRef.current);\n    };\n  }, []); // ============================ Styles ============================\n\n  var mergedStyle = style;\n\n  if (eventHandlers[STEP_PREPARE] && step === STEP_START) {\n    mergedStyle = _objectSpread({\n      transition: 'none'\n    }, mergedStyle);\n  }\n\n  return [status, step, mergedStyle];\n}","map":{"version":3,"sources":["/home/diegozago/Documents/hi-platform-test/node_modules/rc-motion/es/hooks/useStatus.js"],"names":["_objectSpread","_defineProperty","_slicedToArray","React","useState","useRef","useEffect","STATUS_APPEAR","STATUS_NONE","STATUS_LEAVE","STATUS_ENTER","STEP_PREPARE","STEP_START","STEP_ACTIVE","useIsomorphicLayoutEffect","useStepQueue","DoStep","SkipStep","isActive","useDomMotionEvents","useStatus","supportMotion","visible","getElement","_ref","_ref$motionEnter","motionEnter","_ref$motionAppear","motionAppear","_ref$motionLeave","motionLeave","motionDeadline","motionLeaveImmediately","onAppearPrepare","onEnterPrepare","onLeavePrepare","onAppearStart","onEnterStart","onLeaveStart","onAppearActive","onEnterActive","onLeaveActive","onAppearEnd","onEnterEnd","onLeaveEnd","_useState","_useState2","status","setStatus","_useState3","_useState4","style","setStyle","mountedRef","deadlineRef","cacheElementRef","getDomElement","element","current","activeRef","onInternalMotionEnd","event","deadline","target","canEnd","_useDomMotionEvents","_useDomMotionEvents2","patchMotionEvents","eventHandlers","useMemo","_ref2","_ref3","_ref4","_useStepQueue","newStep","onPrepare","step","_eventHandlers$step","call","clearTimeout","setTimeout","_useStepQueue2","startStep","active","isMounted","nextStatus","mergedStyle","transition"],"mappings":"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","sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport * as React from 'react';\nimport { useState, useRef, useEffect } from 'react';\nimport { STATUS_APPEAR, STATUS_NONE, STATUS_LEAVE, STATUS_ENTER, STEP_PREPARE, STEP_START, STEP_ACTIVE } from '../interface';\nimport useIsomorphicLayoutEffect from './useIsomorphicLayoutEffect';\nimport useStepQueue, { DoStep, SkipStep, isActive } from './useStepQueue';\nimport useDomMotionEvents from './useDomMotionEvents'; // import useFrameStep, { StepMap, StepCell } from './useFrameStep';\n\nexport default function useStatus(supportMotion, visible, getElement, _ref) {\n  var _ref$motionEnter = _ref.motionEnter,\n      motionEnter = _ref$motionEnter === void 0 ? true : _ref$motionEnter,\n      _ref$motionAppear = _ref.motionAppear,\n      motionAppear = _ref$motionAppear === void 0 ? true : _ref$motionAppear,\n      _ref$motionLeave = _ref.motionLeave,\n      motionLeave = _ref$motionLeave === void 0 ? true : _ref$motionLeave,\n      motionDeadline = _ref.motionDeadline,\n      motionLeaveImmediately = _ref.motionLeaveImmediately,\n      onAppearPrepare = _ref.onAppearPrepare,\n      onEnterPrepare = _ref.onEnterPrepare,\n      onLeavePrepare = _ref.onLeavePrepare,\n      onAppearStart = _ref.onAppearStart,\n      onEnterStart = _ref.onEnterStart,\n      onLeaveStart = _ref.onLeaveStart,\n      onAppearActive = _ref.onAppearActive,\n      onEnterActive = _ref.onEnterActive,\n      onLeaveActive = _ref.onLeaveActive,\n      onAppearEnd = _ref.onAppearEnd,\n      onEnterEnd = _ref.onEnterEnd,\n      onLeaveEnd = _ref.onLeaveEnd;\n\n  var _useState = useState(STATUS_NONE),\n      _useState2 = _slicedToArray(_useState, 2),\n      status = _useState2[0],\n      setStatus = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      style = _useState4[0],\n      setStyle = _useState4[1];\n\n  var mountedRef = useRef(false);\n  var deadlineRef = useRef(null); // =========================== Dom Node ===========================\n\n  var cacheElementRef = useRef(null);\n\n  function getDomElement() {\n    var element = getElement();\n    return element || cacheElementRef.current;\n  } // ========================== Motion End ==========================\n\n\n  var activeRef = useRef(false);\n\n  function onInternalMotionEnd(event) {\n    var element = getDomElement();\n\n    if (event && !event.deadline && event.target !== element) {\n      // event exists\n      // not initiated by deadline\n      // transitionEnd not fired by inner elements\n      return;\n    }\n\n    var canEnd;\n\n    if (status === STATUS_APPEAR && activeRef.current) {\n      canEnd = onAppearEnd === null || onAppearEnd === void 0 ? void 0 : onAppearEnd(element, event);\n    } else if (status === STATUS_ENTER && activeRef.current) {\n      canEnd = onEnterEnd === null || onEnterEnd === void 0 ? void 0 : onEnterEnd(element, event);\n    } else if (status === STATUS_LEAVE && activeRef.current) {\n      canEnd = onLeaveEnd === null || onLeaveEnd === void 0 ? void 0 : onLeaveEnd(element, event);\n    }\n\n    if (canEnd !== false) {\n      setStatus(STATUS_NONE);\n      setStyle(null);\n    }\n  }\n\n  var _useDomMotionEvents = useDomMotionEvents(onInternalMotionEnd),\n      _useDomMotionEvents2 = _slicedToArray(_useDomMotionEvents, 1),\n      patchMotionEvents = _useDomMotionEvents2[0]; // ============================= Step =============================\n\n\n  var eventHandlers = React.useMemo(function () {\n    var _ref2, _ref3, _ref4;\n\n    switch (status) {\n      case 'appear':\n        return _ref2 = {}, _defineProperty(_ref2, STEP_PREPARE, onAppearPrepare), _defineProperty(_ref2, STEP_START, onAppearStart), _defineProperty(_ref2, STEP_ACTIVE, onAppearActive), _ref2;\n\n      case 'enter':\n        return _ref3 = {}, _defineProperty(_ref3, STEP_PREPARE, onEnterPrepare), _defineProperty(_ref3, STEP_START, onEnterStart), _defineProperty(_ref3, STEP_ACTIVE, onEnterActive), _ref3;\n\n      case 'leave':\n        return _ref4 = {}, _defineProperty(_ref4, STEP_PREPARE, onLeavePrepare), _defineProperty(_ref4, STEP_START, onLeaveStart), _defineProperty(_ref4, STEP_ACTIVE, onLeaveActive), _ref4;\n\n      default:\n        return {};\n    }\n  }, [status]);\n\n  var _useStepQueue = useStepQueue(function (newStep) {\n    // Only prepare step can be skip\n    if (newStep === STEP_PREPARE) {\n      var onPrepare = eventHandlers[STEP_PREPARE];\n\n      if (!onPrepare) {\n        return SkipStep;\n      }\n\n      return onPrepare(getDomElement());\n    } // Rest step is sync update\n\n\n    if (step in eventHandlers) {\n      var _eventHandlers$step;\n\n      setStyle(((_eventHandlers$step = eventHandlers[step]) === null || _eventHandlers$step === void 0 ? void 0 : _eventHandlers$step.call(eventHandlers, getDomElement(), null)) || null);\n    }\n\n    if (step === STEP_ACTIVE) {\n      // Patch events when motion needed\n      patchMotionEvents(getDomElement());\n\n      if (motionDeadline > 0) {\n        clearTimeout(deadlineRef.current);\n        deadlineRef.current = setTimeout(function () {\n          onInternalMotionEnd({\n            deadline: true\n          });\n        }, motionDeadline);\n      }\n    }\n\n    return DoStep;\n  }),\n      _useStepQueue2 = _slicedToArray(_useStepQueue, 2),\n      startStep = _useStepQueue2[0],\n      step = _useStepQueue2[1];\n\n  var active = isActive(step);\n  activeRef.current = active; // ============================ Status ============================\n  // Update with new status\n\n  useIsomorphicLayoutEffect(function () {\n    if (!supportMotion) {\n      return;\n    }\n\n    var isMounted = mountedRef.current;\n    mountedRef.current = true;\n    var nextStatus; // Appear\n\n    if (!isMounted && visible && motionAppear) {\n      nextStatus = STATUS_APPEAR;\n    } // Enter\n\n\n    if (isMounted && visible && motionEnter) {\n      nextStatus = STATUS_ENTER;\n    } // Leave\n\n\n    if (isMounted && !visible && motionLeave || !isMounted && motionLeaveImmediately && !visible && motionLeave) {\n      nextStatus = STATUS_LEAVE;\n    } // Update to next status\n\n\n    if (nextStatus) {\n      setStatus(nextStatus);\n      startStep();\n    }\n  }, [visible]); // ============================ Effect ============================\n  // Reset when motion changed\n\n  useEffect(function () {\n    if ( // Cancel appear\n    status === STATUS_APPEAR && !motionAppear || // Cancel enter\n    status === STATUS_ENTER && !motionEnter || // Cancel leave\n    status === STATUS_LEAVE && !motionLeave) {\n      setStatus(STATUS_NONE);\n    }\n  }, [motionAppear, motionEnter, motionLeave]);\n  useEffect(function () {\n    return function () {\n      clearTimeout(deadlineRef.current);\n    };\n  }, []); // ============================ Styles ============================\n\n  var mergedStyle = style;\n\n  if (eventHandlers[STEP_PREPARE] && step === STEP_START) {\n    mergedStyle = _objectSpread({\n      transition: 'none'\n    }, mergedStyle);\n  }\n\n  return [status, step, mergedStyle];\n}"]},"metadata":{},"sourceType":"module"}